sudo: false
language: node_js
notifications:
  email:
    on_success: change
    on_failure: always
node_js:
- 8.5.0
cache:
  yarn: true
  directories:
  - node_modules
before_install:
- npm install -g npm@5.5.1
script:
- source read.version.sh
- echo $PACKAGE_JSON_VERSION
- yarn run injectTag
- yarn run build
env:
  global:
  - COMMIT_AUTHOR_EMAIL: sandbox_JSUI@coveo.com
deploy:
- provider: s3
  access_key_id: AKIAJYWLLTRYS2WDLCIQ
  secret_access_key:
    secure: JcreczT0+UhFSgrPJK9GQaBEA7ZCNzD0oKl7SycsT9ZTfwD7NMRsyo6p01K2fzeWWzB9XSrQ6JhEUdt1jo/btXsNZJ5Y9Zsfvq7+Y1uokhxeTysOG9xLg7MgSTqMqIB7SW0v/VEe2B6s3G2K5oMhtPJlDaeR/fNRY1obbcSRbLcBhTBO5y5lxEbVJB5R6+lJynMpuPQW8QF4TGklgQjb2d8xqJySh54j7VxaMPA0DTC0Zc6DuhZEdcZHUbYprcbnzfxSZzvYoseBLvh2dvIwsC/wLWYjJEuqv3+hNu44LABLwF29+QZVfeYvm4dHScU8Gtf5TFJmUcZsgs2xqW3uaDkYeGABNHEdckKBVJgHv4w97cvoH7x0pVrP8To0iT4A0DzF4Naxu6iKXSFeAFwyV5J6WbtyLCjP4xt4gF5zzPuKqwArVrVPo9lssxvJSAkGH0qziMgpH/+3WwhEGmsf2oyxZwbdyG9ys5JOsVmnyzx/n+NXQkeEyRs7oeLdC+p0Pj8hgWtEnZ7AC0XvCZENLSRLNgac+nQaXXpCniB/opJJoXZAz+od1bmPpixRxUinr72OfZJ9h1XbMWgY4CKvPLAflpt9f1AmW2g1Xj+le/Vopg+x9xnzxzUe0i4aB3K9wba5C/KTcHHS08VzpVVl8fU/VnF5HH+Lq24uiCa7e8I=
  bucket: olamothe
  local-dir: bin
  upload-dir: searchui/v$PACKAGE_JSON_VERSION
  acl: public_read
  skip_cleanup: true
  on:
    repo: coveo/search-ui
    all_branches: true
after_deploy:
- node invalidate.cloudfront.js
branches:
  only:
  - JSUI-1923
